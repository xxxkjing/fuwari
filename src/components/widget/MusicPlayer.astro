---
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import { faLink, faShare } from '@fortawesome/free-solid-svg-icons';

interface Props {
  cover?: string;
  title?: string;
  description?: string;
  audioSrc?: string;
}

const { 
  cover = '/images/music-cover.jpg', 
  title = '音乐时光', 
  description = '分享近期喜爱的音乐',
  audioSrc = '' 
} = Astro.props;

// 播放状态管理
let isPlaying = false;
let progress = 0;
let currentTime = '0:00';

// 格式化时间
function formatTime(seconds: number): string {
  const mins = Math.floor(seconds / 60);
  const secs = Math.floor(seconds % 60);
  return `${mins}:${secs.toString().padStart(2, '0')}`;
}

// 播放/暂停控制
function togglePlay(audio: HTMLAudioElement) {
  if (audio.paused) {
    audio.play();
    isPlaying = true;
  } else {
    audio.pause();
    isPlaying = false;
  }
}
---

<div class="music-widget">
  <div class="header">
    <img class="cover" src={cover} alt="Music Cover" />
    <div class="text">
      <h2>{title}</h2>
      <p class="desc">{description}</p>
    </div>
  </div>

  <div class="player">
    <div class="vinyl">
      <FontAwesomeIcon 
        icon={isPlaying ? faPause : faPlay} 
        size="sm" 
        color="#d9b382" 
        class="play-icon" 
      />
    </div>
    
    <div class="progress-area">
      <span class="time">{currentTime}</span>
      <div class="progress-bar" onclick={(e) => {
        const audio = document.getElementById('audio-player') as HTMLAudioElement;
        const progressBar = e.currentTarget as HTMLElement;
        const clickPosition = (e.clientX - progressBar.getBoundingClientRect().left) / progressBar.offsetWidth;
        audio.currentTime = clickPosition * audio.duration;
      }}>
        <div class="progress" style={`width: ${progress}%`}></div>
      </div>
    </div>
  </div>

  <div class="actions">
    <FontAwesomeIcon icon={faLink} size="lg" color="#bfa287" />
    <FontAwesomeIcon icon={faShare} size="lg" color="#bfa287" />
  </div>

  {audioSrc && (
    <audio 
      id="audio-player" 
      src={audioSrc} 
      ontimeupdate={(e) => {
        const audio = e.target as HTMLAudioElement;
        progress = (audio.currentTime / audio.duration) * 100;
        currentTime = formatTime(audio.currentTime);
      }}
      onplay={() => isPlaying = true}
      onpause={() => isPlaying = false}
    />
  )}
</div>

<style scoped>
/* 原有样式保持不变 */
.music-widget { /* ... */ }
.header { /* ... */ }
.cover { /* ... */ }
.text h2 { /* ... */ }
.desc { /* ... */ }
.player { /* ... */ }
.vinyl {
  /* 新增：为播放图标定位 */
  display: flex;
  align-items: center;
  justify-content: center;
}
.progress-area { /* ... */ }
.time { /* ... */ }
.progress-bar { /* ... */ }
.progress { /* ... */ }
.actions { /* ... */ }
.actions svg { /* ... */ }
</style>